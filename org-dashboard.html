<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organization Dashboard - Veriss Payments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="assets/css/app.css">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
      /* CSS Custom Properties for Veriss Payments Brand Colors */
      :root {
        --primary-50: #f0f9ff;
        --primary-100: #e0f2fe;
        --primary-200: #bae6fd;
        --primary-300: #7dd3fc;
        --primary-400: #38bdf8;
        --primary-500: #0ea5e9;
        --primary-600: #0284c7;
        --primary-700: #0369a1;
        --primary-800: #075985;
        --primary-900: #0c4a6e;

        --success-50: #f0fdf4;
        --success-100: #dcfce7;
        --success-200: #bbf7d0;
        --success-300: #86efac;
        --success-400: #4ade80;
        --success-500: #22c55e;
        --success-600: #16a34a;
        --success-700: #15803d;
        --success-800: #166534;
        --success-900: #14532d;

        --neutral-50: #fafafa;
        --neutral-100: #f5f5f5;
        --neutral-200: #e5e5e5;
        --neutral-300: #d4d4d4;
        --neutral-400: #a3a3a3;
        --neutral-500: #737373;
        --neutral-600: #525252;
        --neutral-700: #404040;
        --neutral-800: #262626;
        --neutral-900: #171717;

        --error-500: #ef4444;
        --error-600: #dc2626;
        --warning-600: #f59e0b;

        --radius: 0.5rem;
        --radius-md: 0.75rem;
        --radius-lg: 1rem;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      }

      /* Sidebar Styles */
      .sidebar {
        width: 260px;
        min-height: 100vh;
        background: white;
        border-right: 1px solid var(--neutral-200);
        position: fixed;
        left: 0;
        top: 0;
        padding-top: 80px;
        transition: transform 0.3s ease;
        z-index: 100;
      }

      .sidebar-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.875rem 1.5rem;
        color: var(--neutral-700);
        text-decoration: none;
        transition: all 0.2s ease;
        cursor: pointer;
        border-left: 3px solid transparent;
      }

      .sidebar-item:hover {
        background: var(--primary-50);
        color: var(--primary-700);
      }

      .sidebar-item.active {
        background: var(--primary-50);
        color: var(--primary-700);
        border-left-color: var(--primary-600);
        font-weight: 600;
      }

      /* Main Layout */
      .main-content {
        margin-left: 260px;
        min-height: 100vh;
        background: var(--neutral-50);
      }

      .header-bar {
        position: fixed;
        top: 0;
        left: 260px;
        right: 0;
        height: 80px;
        background: white;
        border-bottom: 1px solid var(--neutral-200);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 2rem;
        z-index: 90;
        box-shadow: var(--shadow-sm);
      }

      .content-area {
        margin-top: 80px;
        padding: 2rem;
      }

      /* Loading Overlay */
      .loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid var(--neutral-200);
        border-top-color: var(--primary-600);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--neutral-500);
      }

      .empty-state-icon {
        width: 64px;
        height: 64px;
        margin: 0 auto 1rem;
        opacity: 0.5;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.open {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .header-bar {
          left: 0;
        }
      }

      /* ==================== MODAL STYLES ==================== */
      /* Modal Overlay */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 1rem;
        animation: fadeIn 0.2s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }

        to {
          opacity: 1;
        }
      }

      /* Modal Content */
      .modal-content {
        background: white;
        border-radius: var(--radius-lg);
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-2xl);
        animation: slideUp 0.3s ease-out;
      }

      @keyframes slideUp {
        from {
          transform: translateY(20px);
          opacity: 0;
        }

        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      /* Modal Header */
      .modal-header {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--neutral-200);
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        background: white;
        z-index: 10;
      }

      /* Modal Body */
      .modal-body {
        padding: 2rem;
      }

      /* Form Section */
      .form-section {
        margin-bottom: 2rem;
      }

      .form-section-title {
        font-size: 0.875rem;
        font-weight: 700;
        color: var(--neutral-900);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--neutral-200);
      }

      /* Status Badge */
      .status-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .status-paid {
        background: var(--success-100);
        color: var(--success-800);
      }

      .status-pending {
        background: #fef3c7;
        color: #92400e;
      }

      /* Service Card Styles - Ultra Compact */
      .service-card {
        background: white;
        border: 1px solid var(--neutral-200);
        border-radius: var(--radius-md);
        padding: 0.45rem;
        box-shadow: var(--shadow-sm);
        transition: all 0.2s ease;
        font-size: 0.75rem;
      }

      .service-card:hover {
        box-shadow: var(--shadow-md);
        transform: translateY(-1px);
      }

      .balance-section {
        text-align: center;
        padding: 0.3rem 0;
        border-bottom: 1px solid var(--neutral-100);
      }

      .balance-section .text-xs {
        font-size: 0.65rem;
      }

      .balance-section .text-2xl {
        font-size: 1rem;
      }

      .transaction-section {
        padding: 0.3rem 0;
        border-bottom: 1px solid var(--neutral-100);
      }

      .transaction-section .text-xs {
        font-size: 0.65rem;
      }

      .transaction-section .text-sm {
        font-size: 0.7rem;
      }

      .card-details {
        padding: 0.3rem 0;
      }

      .card-details .text-sm {
        font-size: 0.7rem;
      }

      .service-card h3 {
        font-size: 0.9rem;
        margin-bottom: 0.3rem;
      }

      .service-card .status-badge {
        font-size: 0.6rem;
        padding: 0.15rem 0.4rem;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <!-- Loading Overlay -->
      <div v-if="isGlobalLoading" class="loading-overlay">
        <div>
          <div class="spinner"></div>
          <p class="mt-4 text-sm font-semibold" style="color: var(--neutral-700);">Loading...</p>
        </div>
      </div>

      <!-- Sidebar Navigation -->
      <aside class="sidebar" :class="{ open: sidebarOpen }">
        <div class="flex flex-col">
          <a @click="setActiveView('dashboard')" :class="['sidebar-item', { active: activeView === 'dashboard' }]">
            <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
            <span>Dashboard</span>
          </a>
          <a @click="setActiveView('payment-services')"
            :class="['sidebar-item', { active: activeView === 'payment-services' }]">
            <i data-lucide="credit-card" class="w-5 h-5"></i>
            <span>Payment Services</span>
          </a>
          <a @click="setActiveView('subscribers')" :class="['sidebar-item', { active: activeView === 'subscribers' }]">
            <i data-lucide="users" class="w-5 h-5"></i>
            <span>Subscribers</span>
          </a>
          <a @click="setActiveView('bank-details')"
            :class="['sidebar-item', { active: activeView === 'bank-details' }]">
            <i data-lucide="building-2" class="w-5 h-5"></i>
            <span>Bank Details</span>
          </a>
          <a href="/org-profile.html" class="sidebar-item" :class="{ active: activeView === 'profile' }"
            >
            <i data-lucide="user" class="w-5 h-5"></i>
            <span>Profile</span>
          </a>

        </div>
      </aside>

      <!-- Main Content Area -->
      <div class="main-content">
        <!-- Header Bar -->
        <header class="header-bar">
          <div class="flex items-center gap-4">
            <button @click="toggleSidebar" class="lg:hidden p-2 hover:bg-gray-100 rounded">
              <i data-lucide="menu" class="w-5 h-5"></i>
            </button>
            <h1 class="text-lg font-bold" style="color: var(--neutral-900);">VERISS PAYMENTS</h1>
          </div>
          <div class="flex items-center gap-4">
            <span class="hidden md:inline font-semibold" style="color: var(--neutral-700);">
              {{ organizationName }}
            </span>
            <a href="org-profile.html" class="flex items-center gap-2 cursor-pointer hover:opacity-90">
              <div class="w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold"
                style="background: var(--primary-600);">
                {{ userInitials }}
              </div>

              <span class="hidden md:inline text-sm" style="color: var(--neutral-700);">
                {{ userName }}
              </span>
            </a>

            <button @click="handleLogout" class="btn btn-outline text-sm px-3 py-2">
              <i data-lucide="log-out" class="w-4 h-4"></i>
              <span class="hidden md:inline ml-2">Logout</span>
            </button>
          </div>
        </header>

        <!-- Content Area -->
        <div class="content-area">
          <!-- Dashboard View -->
          <div v-if="activeView === 'dashboard'" class="dashboard-view">
            <div class="mb-6">
              <h2 class="text-2xl font-bold mb-4" style="color: var(--neutral-900);">Dashboard Overview</h2>
              <div class="flex items-center gap-4 mb-4">
                <label for="year-select" class="text-sm font-semibold" style="color: var(--neutral-700);">Filter by
                  Year:</label>
                <select id="year-select" v-model="selectedYear" @change="loadDashboardStats(selectedYear)"
                  class="modern-input" style="max-width: 150px;">
                  <option value="all">All Years</option>
                  <option v-for="year in availableYears" :value="year" :key="year">{{ year }}</option>
                </select>
              </div>
              <p v-if="noDataMessage" class="text-red-500 text-sm mt-2">{{ noDataMessage }}</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
              <div class="stat-card">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="text-xs font-bold uppercase tracking-wider" style="color: var(--neutral-500);">Subscribers
                  </h3>
                  <i data-lucide="users" class="w-6 h-6" style="color: var(--primary-600);"></i>
                </div>
                <p class="text-3xl font-bold mb-1" style="color: var(--primary-600);">
                  {{ stats.subscribers || 0 }}
                </p>
              </div>

              <div class="stat-card">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="text-xs font-bold uppercase tracking-wider" style="color: var(--neutral-500);">Payments
                  </h3>
                  <i data-lucide="credit-card" class="w-6 h-6" style="color: var(--success-600);"></i>
                </div>
                <p class="text-xl font-bold mb-1" style="color: var(--success-600);">
                  {{ stats.payments || 0 }}
                </p>
              </div>

              <div class="stat-card">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="text-xs font-bold uppercase tracking-wider" style="color: var(--neutral-500);">Services
                  </h3>
                  <i data-lucide="file-text" class="w-6 h-6" style="color: var(--warning-600);"></i>
                </div>
                <p class="text-xl font-bold mb-1" style="color: var(--warning-600);">
                  {{ stats.paymentServices || 0 }}
                </p>
              </div>

              <div class="stat-card">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="text-xs font-bold uppercase tracking-wider" style="color: var(--neutral-500);">Revenue</h3>
                  <i data-lucide="trending-up" class="w-6 h-6" style="color: var(--primary-600);"></i>
                </div>
                <p class="text-xl font-bold mb-1" style="color: var(--primary-600);">
                  ₦{{ formatCurrency(stats.totalRevenue || 0) }}
                </p>
              </div>
            </div>

            <!-- Recent Activity & Top Services -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
              <!-- Recent Activity -->
              <div class="modern-card">
                <h3 class="text-lg font-bold mb-4" style="color: var(--neutral-900);">Recent Activity</h3>
                <div v-if="recentActivity.length > 0" class="space-y-3 max-h-64 overflow-y-auto">
                  <div v-for="activity in recentActivity" :key="activity._id"
                    class="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="w-2 h-2 rounded-full mt-2" style="background: var(--primary-600);"></div>
                    <div class="flex-1">
                      <p class="text-sm" style="color: var(--neutral-900);">{{ activity.summary }}</p>
                      <p class="text-xs mt-1" style="color: var(--neutral-500);">{{ formatDate(activity.createdAt) }}
                      </p>
                    </div>
                  </div>
                </div>
                <div v-else class="empty-state py-8">
                  <i data-lucide="inbox" class="empty-state-icon"></i>
                  <p>No recent activity</p>
                </div>
              </div>

              <!-- Top Services -->
              <div class="modern-card">
                <h3 class="text-lg font-bold mb-4" style="color: var(--neutral-900);">Top Payment Services</h3>
                <div v-if="topServices.length > 0" class="space-y-3 max-h-64 overflow-y-auto">
                  <div v-for="(service, idx) in topServices" :key="service._id"
                    class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="flex-1">
                      <p class="font-semibold text-sm" style="color: var(--neutral-900);">
                        {{ idx + 1 }}. {{ service.name }}
                      </p>
                      <p class="text-xs mt-1" style="color: var(--neutral-500);">
                        {{ service.type }}
                      </p>
                    </div>
                    <p class="font-bold text-lg" style="color: var(--primary-600);">
                      ₦{{ formatCurrency(service.totalAmountPaid) }}
                    </p>
                  </div>
                </div>
                <div v-else class="empty-state py-8">
                  <i data-lucide="trending-up" class="empty-state-icon"></i>
                  <p>No services yet</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Payment Services View -->
          <div v-if="activeView === 'payment-services'" class="payment-services-view">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <h2 class="text-2xl font-bold" style="color: var(--neutral-900);">Payment Services</h2>
              <div class="flex flex-col md:flex-row gap-3">
                <input v-model="serviceSearch" type="text" placeholder="Search services..." class="modern-input"
                  style="min-width: 250px;">
                <button @click="openCreateServiceModal" class="btn btn-primary">
                  <i data-lucide="plus" class="w-4 h-4"></i>
                  <span>Create Service</span>
                </button>
              </div>
            </div>

            <!-- Service Tabs -->
            <div class="flex gap-4 mb-6 border-b" style="border-color: var(--neutral-200);">
              <button @click="serviceFilter = 'all'" :class="[
              'px-4 py-2 font-semibold border-b-2 transition-colors',
              serviceFilter === 'all' ? 'border-primary-600 text-primary-600' : 'border-transparent text-neutral-500'
            ]"
                :style="serviceFilter === 'all' ? { borderColor: 'var(--primary-600)', color: 'var(--primary-600)' } : {}">
                All Services ({{ paymentServices.length }})
              </button>
              <button @click="serviceFilter = 'active'" :class="[
              'px-4 py-2 font-semibold border-b-2 transition-colors',
              serviceFilter === 'active' ? 'border-primary-600 text-primary-600' : 'border-transparent text-neutral-500'
            ]"
                :style="serviceFilter === 'active' ? { borderColor: 'var(--primary-600)', color: 'var(--primary-600)' } : {}">
                Active ({{ activeServicesCount }})
              </button>
              <button @click="serviceFilter = 'suspended'" :class="[
              'px-4 py-2 font-semibold border-b-2 transition-colors',
              serviceFilter === 'suspended' ? 'border-primary-600 text-primary-600' : 'border-transparent text-neutral-500'
            ]"
                :style="serviceFilter === 'suspended' ? { borderColor: 'var(--primary-600)', color: 'var(--primary-600)' } : {}">
                Suspended ({{ suspendedServicesCount }})
              </button>
            </div>


            <!-- Services Grid -->
            <div v-if="filteredServices.length > 0"
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">

              <div v-for="service in filteredServices" :key="service._id" class="service-card"
                style="padding: 1.15rem;">
                <!-- Card Header -->
                <div class="flex items-center justify-between mb-3.5">
                  <h3 class="font-semibold text-base truncate" style="color: var(--neutral-900);">
                    {{ service.name }}
                  </h3>

                  <span :class="getStatusBadgeClass(service.status)" class="status-badge text-xs ml-2 flex-shrink-0">
                    {{ service.status }}
                  </span>
                </div>

                <!-- Service Info -->
                <div class="mb-3.5 space-y-2">
                  <p class="text-xs uppercase tracking-wider font-medium" style="color: var(--neutral-500);">
                    Service Type
                  </p>

                  <p class="text-sm font-semibold" style="color: var(--primary-600);">
                    {{ service.type }}
                  </p>

                  <p class="text-xs line-clamp-2" style="color: var(--neutral-600);">
                    {{ service.description || 'No description provided' }}
                  </p>

                  <div class="flex items-center gap-1.5 mt-2">
                    <i data-lucide="calendar" class="w-3.5 h-3.5" style="color: var(--neutral-400);"></i>
                    <span class="text-xs" style="color: var(--neutral-500);">
                      Created {{ formatDate(service.createdAt) }}
                    </span>
                  </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-1.5">
                  <button @click="viewService(service)" class="btn btn-primary text-xs flex-1 px-2.5 py-2">
                    <i data-lucide="eye" class="w-3 h-3"></i>
                    View
                  </button>

                  <button @click="editService(service)" class="btn btn-secondary text-xs flex-1 px-2.5 py-2">
                    <i data-lucide="edit" class="w-3 h-3"></i>
                    Edit
                  </button>

                  <button @click="deleteService(service)" class="btn btn-secondary text-xs px-2.5 py-2"
                    style="background: var(--error-500); color: white;">
                    <i data-lucide="trash-2" class="w-3 h-3"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Empty State -->
            <div v-else class="empty-state">
              <i data-lucide="credit-card" class="empty-state-icon"></i>
              <p class="text-lg font-semibold mb-2">No payment services found</p>
              <p class="mb-4">Create your first payment service to get started</p>
              <button @click="openCreateServiceModal" class="btn btn-primary">
                <i data-lucide="plus" class="w-4 h-4"></i>
                <span>Create Service</span>
              </button>
            </div>


          </div>

          <!-- Subscribers View -->
          <div v-if="activeView === 'subscribers'" class="subscribers-view">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <h2 class="text-2xl font-bold" style="color: var(--neutral-900);">
                Subscribers ({{ subscribers.length }})
              </h2>
              <input v-model="subscriberSearch" type="text" placeholder="Search subscribers..." class="modern-input"
                style="min-width: 250px;">
            </div>

            <!-- Subscribers Table -->
            <div v-if="filteredSubscribers.length > 0" class="data-table">
              <table class="modern-table w-full">
                <thead>
                  <tr>
                    <th class="text-left p-4">#</th>
                    <th class="text-left p-4">Name</th>
                    <th class="text-left p-4">Email</th>
                    <th class="text-left p-4">Status</th>
                    <th class="text-left p-4">Joined</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(subscriber, idx) in filteredSubscribers" :key="subscriber._id" class="border-t"
                    style="border-color: var(--neutral-200);">
                    <td class="p-4 text-sm">{{ idx + 1 }}</td>
                    <td class="p-4 font-semibold text-sm" style="color: var(--neutral-900);">
                      {{ subscriber.subscriber.fullName }}
                    </td>
                    <td class="p-4 text-sm" style="color: var(--neutral-600);">
                      {{ subscriber.subscriber.email }}
                    </td>
                    <td class="p-4">
                      <span :class="getStatusBadgeClass(subscriber.status)" class="status-badge text-xs">
                        {{ subscriber.status }}
                      </span>
                    </td>
                    <td class="p-4 text-sm" style="color: var(--neutral-600);">
                      {{ formatDate(subscriber.joinedAt) }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Empty State -->
            <div v-else class="empty-state">
              <i data-lucide="users" class="empty-state-icon"></i>
              <p class="text-lg font-semibold mb-2">No subscribers found</p>
              <p>Subscribers will appear here once they join</p>
            </div>
          </div>

          <!-- Bank Details View -->
          <div v-if="activeView === 'bank-details'" class="bank-details-view">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <h2 class="text-2xl font-bold" style="color: var(--neutral-900);">Bank Accounts</h2>
              <button @click="openAddBankModal" class="btn btn-primary">
                <i data-lucide="plus" class="w-4 h-4"></i>
                <span>Add Bank Account</span>
              </button>
            </div>

            <!-- Bank Accounts List -->
            <div v-if="bankAccounts.length > 0" class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div v-for="account in bankAccounts" :key="account._id" class="modern-card">
                <div class="flex items-start justify-between mb-4">
                  <div class="flex-1">
                    <h4 class="font-bold text-lg mb-2" style="color: var(--neutral-900);">{{ account.bankName }}</h4>
                    <p class="text-sm mb-1" style="color: var(--neutral-600);">
                      Account: {{ account.accountNumber }}
                    </p>
                    <p class="text-sm mb-3" style="color: var(--neutral-600);">
                      Name: {{ account.accountName }}
                    </p>
                    <span class="status-badge text-xs"
                      style="background: var(--success-100); color: var(--success-800);">
                      ✓ Verified
                    </span>
                  </div>
                </div>
                <div class="flex gap-2">
                  <button @click="editBankAccount(account)" class="btn btn-secondary text-sm flex-1">
                    Edit
                  </button>
                  <button @click="deleteBankAccount(account)" class="btn btn-secondary text-sm flex-1">
                    Delete
                  </button>
                </div>
              </div>
            </div>

            <!-- Empty State -->
            <div v-else class="empty-state">
              <i data-lucide="building-2" class="empty-state-icon"></i>
              <p class="text-lg font-semibold mb-2">No bank accounts added</p>
              <p class="mb-4">Add a bank account to receive payments</p>
              <button @click="openAddBankModal" class="btn btn-primary">
                <i data-lucide="plus" class="w-4 h-4"></i>
                <span>Add Bank Account</span>
              </button>
            </div>
          </div>

          <!-- Settings View -->
          <div v-if="activeView === 'settings'" class="settings-view">
            <h2 class="text-2xl font-bold mb-6" style="color: var(--neutral-900);">Settings</h2>
            <div class="modern-card">
              <p style="color: var(--neutral-600);">Settings page coming soon...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Modals will be added in Part 2 (JavaScript section) -->
      <!-- ===================================================================
     ORGANIZATION DASHBOARD - MODAL COMPONENTS
     =================================================================== -->

      <!-- ==================== CREATE/EDIT SERVICE MODAL ==================== -->

      <div v-if="showCreateServiceModal" class="modal-overlay" @click.self="closeCreateServiceModal">
        <div class="modal-content" style="max-width: 900px;">
          <div class="modal-header">
            <h3 class="text-xl font-bold" style="color: var(--neutral-900);">
              {{ isEditMode ? 'Edit Payment Service' : 'Create Payment Service' }}
            </h3>
            <button @click="closeCreateServiceModal" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
              <i data-lucide="x" class="w-5 h-5" style="color: var(--neutral-500);"></i>
            </button>
          </div>

          <div class="modal-body">
            <form @submit.prevent="createService" class="space-y-6">

              <!-- Basic Information Section -->
              <div class="form-section">
                <h4 class="form-section-title">Basic Information</h4>
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                      Service Name <span style="color: var(--error-500);">*</span>
                    </label>
                    <input v-model="newService.name" type="text" required class="modern-input"
                      placeholder="e.g., Annual Membership Dues 2025">
                  </div>

                  <div>
                    <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                      Description
                    </label>
                    <textarea v-model="newService.description" rows="3" class="modern-input"
                      placeholder="Describe what this payment service is for..."></textarea>
                  </div>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                        Service Type
                      </label>
                      <select v-model="newService.type" class="modern-input">
                        <option value="event-registration">Event Registration</option>
                        <option value="membership-dues">Membership Dues</option>
                        <option value="donation">Donation</option>
                        <option value="other-payment">Other Payment</option>
                      </select>
                    </div>

                    <div>
                      <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                        Amount (₦) <span style="color: var(--error-500);">*</span>
                      </label>
                      <input v-model.number="newService.serviceCost" type="number" required min="0" class="modern-input"
                        placeholder="10000">
                    </div>
                  </div>
                </div>
              </div>

              <!-- Payment Window Section -->
              <div class="form-section">
                <h4 class="form-section-title">Payment Window</h4>
                <div class="space-y-4">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                        Start Date
                      </label>
                      <input v-model="newService.startDate" type="date" class="modern-input">
                      <p class="text-xs mt-1" style="color: var(--neutral-500);">Leave empty for no start date</p>
                    </div>

                    <div>
                      <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                        Expiry Date
                      </label>
                      <input v-model="newService.expiryDate" type="date" class="modern-input">
                      <p class="text-xs mt-1" style="color: var(--neutral-500);">Leave empty for no expiry</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Bank Account Section -->
              <div class="form-section">
                <h4 class="form-section-title">Settlement Account</h4>
                <div class="space-y-3">
                  <div>
                    <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                      Select Bank Account
                    </label>
                    <select v-model="newService.paymentSubaccount" class="modern-input">
                      <option value="">Select account...</option>
                      <option v-for="account in bankAccounts" :key="account._id" :value="account.subaccount">
                        {{ account.bankName }} - {{ account.accountNumber }}
                      </option>
                    </select>
                    <p class="text-xs mt-1" style="color: var(--neutral-500);">
                      Payments will be settled to this account
                    </p>
                  </div>
                  <button type="button" @click="openAddBankModal" class="btn btn-secondary text-sm">
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    Add New Bank Account
                  </button>
                </div>
              </div>

              <!-- Custom Fields Section -->
              <div class="form-section">
                <h4 class="form-section-title">Custom Data Collection</h4>
                <div class="space-y-3">
                  <label class="flex items-center gap-2">
                    <input type="checkbox" v-model="newService.collectCustomData" class="w-4 h-4">
                    <span class="text-sm" style="color: var(--neutral-700);">Collect additional information from
                      payers</span>
                  </label>

                  <div v-if="newService.collectCustomData" class="space-y-3">
                    <button type="button" @click="openCustomFieldModal" class="btn btn-secondary text-sm">
                      <i data-lucide="plus" class="w-4 h-4"></i>
                      Add Custom Field
                    </button>

                    <!-- Custom Fields List -->
                    <div v-if="newService.customFields.length > 0" class="space-y-2">
                      <div v-for="(field, index) in newService.customFields" :key="index"
                        class="flex items-center justify-between p-3 rounded-lg" style="background: var(--neutral-50);">
                        <div>
                          <p class="font-semibold text-sm" style="color: var(--neutral-900);">{{ field.name }}</p>
                          <p class="text-xs" style="color: var(--neutral-600);">
                            Type: {{ field.type }} | {{ field.required ? 'Required' : 'Optional' }}
                          </p>
                        </div>
                        <button type="button" @click="removeCustomField(index)"
                          class="p-2 hover:bg-red-100 rounded transition-colors">
                          <i data-lucide="trash-2" class="w-4 h-4" style="color: var(--error-500);"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Form Actions -->
              <div class="flex justify-end gap-3 pt-4 border-t" style="border-color: var(--neutral-200);">
                <button type="button" @click="closeCreateServiceModal" class="btn btn-secondary">
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                  <i :data-lucide="isEditMode ? 'save' : 'check'" class="w-4 h-4"></i>
                  {{ isEditMode ? 'Update Service' : 'Create Service' }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- ==================== EDIT BANK ACCOUNT MODAL ==================== -->

      <div v-if="showEditBankModal" class="modal-overlay" @click.self="closeEditBankModal">
        <div class="modal-content" style="max-width: 600px;">
          <div class="modal-header">
            <h3 class="text-xl font-bold" style="color: var(--neutral-900);">Edit Bank Account</h3>
            <button @click="closeEditBankModal" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
              <i data-lucide="x" class="w-5 h-5" style="color: var(--neutral-500);"></i>
            </button>
          </div>

          <div class="modal-body">
            <form @submit.prevent="updateBankAccount" class="space-y-4">

              <!-- Country -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Country <span style="color: var(--error-500);">*</span>
                </label>
                <select v-model="selectedCountry" @change="fetchBanks(selectedCountry.toLowerCase())"
                  class="modern-input" required>
                  <option v-for="country in bankCountries" :key="country.iso_code" :value="country.name">
                    {{ country.name }}
                  </option>
                </select>
              </div>

              <!-- Bank Name -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Bank Name <span style="color: var(--error-500);">*</span>
                </label>
                <select v-model="selectedBank" @change="onBankChange" class="modern-input" required>
                  <option value="">Select bank...</option>
                  <option v-for="bank in banks" :key="bank.code" :value="bank">
                    {{ bank.name }}
                  </option>
                </select>
              </div>

              <div>
                <input type="hidden" v-model="newBankAccount.bankCode" />
              </div>
              <!-- Account Number -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Account Number <span style="color: var(--error-500);">*</span>
                </label>
                <div class="flex gap-2">
                  <input v-model="newBankAccount.accountNumber" type="text" required maxlength="10"
                    class="modern-input flex-1" placeholder="0123456789">
                  <button type="button" @click="verifyBankAccount" :disabled="isVerifyingAccount"
                    class="btn btn-secondary text-sm whitespace-nowrap">
                    <i v-if="!isVerifyingAccount" data-lucide="check-circle" class="w-4 h-4"></i>
                    <span v-if="isVerifyingAccount">Verifying...</span>
                    <span v-else>Verify</span>
                  </button>
                </div>
                <p class="text-xs mt-1" style="color: var(--neutral-500);">
                  10-digit account number
                </p>
              </div>

              <!-- Account Name -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Account Name <span style="color: var(--error-500);">*</span>
                </label>
                <input v-model="newBankAccount.accountName" type="text" required class="modern-input" disabled
                  :placeholder="newBankAccount.accountName ? newBankAccount.accountName : 'Will be auto-filled after verification'">
              </div>

              <!-- Form Actions -->
              <div class="flex justify-end gap-3 pt-4 border-t" style="border-color: var(--neutral-200);">
                <button type="button" @click="closeEditBankModal" class="btn btn-secondary">
                  Cancel
                </button>
                <button type="button" @click="verifyBankAccount" :disabled="isVerifyingAccount"
                  class="btn btn-secondary">
                  <i v-if="!isVerifyingAccount" data-lucide="check-circle" class="w-4 h-4"></i>
                  <span v-if="isVerifyingAccount">Verifying...</span>
                  <span v-else>Verify Account</span>
                </button>
                <button type="submit" class="btn btn-primary">
                  <i data-lucide="save" class="w-4 h-4"></i>
                  Update Bank
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- ==================== UPDATED VIEW SERVICE MODAL ==================== -->

      <div v-if="showServiceModal && selectedService" class="modal-overlay" @click.self="showServiceModal = false">
        <div class="modal-content" style="max-width: 800px;">
          <div class="modal-header">
            <div>
              <h3 class="text-xl font-bold" style="color: var(--neutral-900);">{{ selectedService.name }}</h3>
              <p class="text-sm mt-1" style="color: var(--neutral-600);">{{ selectedService.type }}</p>
            </div>
            <button @click="showServiceModal = false" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
              <i data-lucide="x" class="w-5 h-5" style="color: var(--neutral-500);"></i>
            </button>
          </div>

          <div class="modal-body">
            <div class="space-y-6">

              <!-- Status Badge -->
              <div>
                <span :class="getStatusBadgeClass(selectedService.status)" class="status-badge">
                  {{ selectedService.status }}
                </span>
              </div>

              <!-- Basic Info -->
              <div class="form-section">
                <h4 class="form-section-title">Service Information</h4>
                <div class="space-y-3">
                  <div>
                    <label class="block text-xs font-bold mb-1" style="color: var(--neutral-500);">Description</label>
                    <p class="text-sm" style="color: var(--neutral-900);">
                      {{ selectedService.description || 'No description provided' }}
                    </p>
                  </div>

                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-xs font-bold mb-1" style="color: var(--neutral-500);">Service
                        Cost</label>
                      <p class="text-lg font-bold" style="color: var(--primary-600);">
                        ₦{{ formatCurrency(selectedService.serviceCost) }}
                      </p>
                    </div>
                    <div>
                      <label class="block text-xs font-bold mb-1" style="color: var(--neutral-500);">Total Usage</label>
                      <p class="text-lg font-bold" style="color: var(--success-600);">
                        {{ selectedService.totalUsage || 0 }} payments
                      </p>
                    </div>
                  </div>

                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-xs font-bold mb-1" style="color: var(--neutral-500);">Start Date</label>
                      <p class="text-sm" style="color: var(--neutral-900);">{{ formatDate(selectedService.startDate) }}
                      </p>
                    </div>
                    <div>
                      <label class="block text-xs font-bold mb-1" style="color: var(--neutral-500);">Expiry Date</label>
                      <p class="text-sm" style="color: var(--neutral-900);">{{ formatDate(selectedService.expiryDate) }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Statistics -->
              <div class="form-section">
                <h4 class="form-section-title">Performance</h4>
                <div class="grid grid-cols-3 gap-4">
                  <div class="p-4 rounded-lg" style="background: var(--primary-50);">
                    <p class="text-xs font-bold mb-1" style="color: var(--neutral-600);">Total Revenue</p>
                    <p class="text-2xl font-bold" style="color: var(--primary-600);">
                      ₦{{ formatCurrency(selectedService.totalAmountPaid || 0) }}
                    </p>
                  </div>
                  <div class="p-4 rounded-lg" style="background: var(--success-50);">
                    <p class="text-xs font-bold mb-1" style="color: var(--neutral-600);">Payments</p>
                    <p class="text-2xl font-bold" style="color: var(--success-600);">
                      {{ selectedService.totalUsage || 0 }}
                    </p>
                  </div>
                  <div class="p-4 rounded-lg" style="background: var(--neutral-100);">
                    <p class="text-xs font-bold mb-1" style="color: var(--neutral-600);">Platform Fee</p>
                    <p class="text-2xl font-bold" style="color: var(--neutral-700);">
                      {{ selectedService.platformFee || 2 }}%
                    </p>
                  </div>
                </div>
              </div>

              <!-- Custom Fields -->
              <div v-if="selectedService.customFields && selectedService.customFields.length > 0" class="form-section">
                <h4 class="form-section-title">Custom Fields</h4>
                <div class="space-y-2">
                  <div v-for="field in selectedService.customFields" :key="field._id"
                    class="flex items-center justify-between p-3 rounded-lg" style="background: var(--neutral-50);">
                    <div>
                      <p class="font-semibold text-sm" style="color: var(--neutral-900);">{{ field.name }}</p>
                      <p class="text-xs" style="color: var(--neutral-600);">
                        Type: {{ field.type }} | {{ field.required ? 'Required' : 'Optional' }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Actions with Full CRUD -->
              <div class="flex justify-end gap-3 pt-4 border-t" style="border-color: var(--neutral-200);">
                <button @click="showServiceModal = false" class="btn btn-secondary">
                  Close
                </button>
                <button v-if="selectedService.status === 'active'"
                  @click="toggleServiceStatus(selectedService); showServiceModal = false" class="btn btn-secondary">
                  <i data-lucide="pause-circle" class="w-4 h-4"></i>
                  Suspend
                </button>
                <button v-else @click="toggleServiceStatus(selectedService); showServiceModal = false"
                  class="btn btn-secondary" style="background: var(--success-600); color: white;">
                  <i data-lucide="play-circle" class="w-4 h-4"></i>
                  Activate
                </button>
                <button @click="showServiceModal = false; editService(selectedService)" class="btn btn-primary">
                  <i data-lucide="edit" class="w-4 h-4"></i>
                  Edit Service
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== ADD BANK ACCOUNT MODAL ==================== -->
      <div v-if="showAddBankModal" class="modal-overlay" @click.self="closeAddBankModal">
        <div class="modal-content" style="max-width: 600px;">
          <div class="modal-header">
            <h3 class="text-xl font-bold" style="color: var(--neutral-900);">Add Bank Account</h3>
            <button @click="closeAddBankModal" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
              <i data-lucide="x" class="w-5 h-5" style="color: var(--neutral-500);"></i>
            </button>
          </div>

          <div class="modal-body">
            <form @submit.prevent="addBankAccount" class="space-y-4">

              <!-- Country -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Country <span style="color: var(--error-500);">*</span>
                </label>
                <select v-model="selectedCountry" @change="fetchBanks(selectedCountry.toLowerCase())"
                  class="modern-input" required>
                  <option v-for="country in bankCountries" :key="country.iso_code" :value="country.name">
                    {{ country.name }}
                  </option>
                </select>
              </div>

              <!-- Bank Name -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Bank Name <span style="color: var(--error-500);">*</span>
                </label>
                <select v-model="selectedBank" @change="onBankChange" class="modern-input" required>
                  <option value="">Select bank...</option>
                  <option v-for="bank in banks" :key="bank.code" :value="bank">
                    {{ bank.name }}
                  </option>
                </select>
              </div>

              <!-- Bank Code -->
              <div>
                <input type="hidden" v-model="newBankAccount.bankCode" />
              </div>

              <!-- Account Number -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Account Number <span style="color: var(--error-500);">*</span>
                </label>
                <div class="flex gap-2">
                  <input v-model="newBankAccount.accountNumber" type="text" required maxlength="10"
                    class="modern-input flex-1" placeholder="0123456789">
                  <button type="button" @click="verifyBankAccount" :disabled="isVerifyingAccount"
                    class="btn btn-secondary text-sm whitespace-nowrap">
                    <i v-if="!isVerifyingAccount" data-lucide="check-circle" class="w-4 h-4"></i>
                    <span v-if="isVerifyingAccount">Verifying...</span>
                    <span v-else>Verify</span>
                  </button>
                </div>
                <p class="text-xs mt-1" style="color: var(--neutral-500);">
                  10-digit account number
                </p>
              </div>

              <!-- Account Name (Auto-filled after verification) -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Account Name <span style="color: var(--error-500);">*</span>
                </label>
                <input v-model="newBankAccount.accountName" type="text" required class="modern-input" disabled
                  :placeholder="newBankAccount.accountName ? newBankAccount.accountName : 'Will be auto-filled after verification'">
                <p class="text-xs mt-1" style="color: var(--neutral-500);">
                  Verify account to auto-fill this field
                </p>
              </div>

              <!-- Important Note -->
              <div class="p-4 rounded-lg" style="background: var(--primary-50); border: 1px solid var(--primary-200);">
                <div class="flex gap-3">
                  <i data-lucide="info" class="w-5 h-5 flex-shrink-0" style="color: var(--primary-600);"></i>
                  <div>
                    <p class="text-sm font-semibold mb-1" style="color: var(--primary-900);">Important</p>
                    <p class="text-xs" style="color: var(--primary-800);">
                      The account name must match exactly as it appears on your bank statement.
                      This account will be used to receive payments from your services.
                    </p>
                  </div>
                </div>
              </div>

              <!-- Form Actions -->
              <div class="flex justify-end gap-3 pt-4 border-t" style="border-color: var(--neutral-200);">
                <button type="button" @click="closeAddBankModal" class="btn btn-secondary">
                  Cancel
                </button>
                <button type="button" @click="verifyBankAccount" :disabled="isVerifyingAccount"
                  class="btn btn-secondary">
                  <i v-if="!isVerifyingAccount" data-lucide="check-circle" class="w-4 h-4"></i>
                  <span v-if="isVerifyingAccount">Verifying...</span>
                  <span v-else>Verify Account</span>
                </button>
                <button type="submit" class="btn btn-primary">
                  <i data-lucide="check" class="w-4 h-4"></i>
                  Add Bank
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- ==================== CUSTOM FIELD MODAL ==================== -->
      <div v-if="showCustomFieldModal" class="modal-overlay" @click.self="closeCustomFieldModal">
        <div class="modal-content" style="max-width: 500px;">
          <div class="modal-header">
            <h3 class="text-xl font-bold" style="color: var(--neutral-900);">Add Custom Field</h3>
            <button @click="closeCustomFieldModal" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
              <i data-lucide="x" class="w-5 h-5" style="color: var(--neutral-500);"></i>
            </button>
          </div>

          <div class="modal-body">
            <form @submit.prevent="addCustomField" class="space-y-4">

              <!-- Field Name -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Field Name <span style="color: var(--error-500);">*</span>
                </label>
                <input v-model="newCustomField.name" type="text" required class="modern-input"
                  placeholder="e.g., Member ID, Phone Number, Date of Birth">
              </div>

              <!-- Field Type -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Field Type <span style="color: var(--error-500);">*</span>
                </label>
                <select v-model="newCustomField.type" class="modern-input">
                  <option value="text">Text</option>
                  <option value="number">Number</option>
                  <option value="email">Email</option>
                  <option value="tel">Phone Number</option>
                  <option value="date">Date</option>
                  <option value="select-option">Dropdown Selection</option>
                  <option value="textarea">Long Text (Multiple Lines)</option>
                </select>
              </div>

              <!-- Options (for select-option type) -->
              <div v-if="newCustomField.type === 'select-option'">
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Dropdown Options
                </label>
                <textarea v-model="newCustomField.optionsText" rows="4" class="modern-input"
                  placeholder="Enter each option on a new line:&#10;Option 1&#10;Option 2&#10;Option 3"></textarea>
                <p class="text-xs mt-1" style="color: var(--neutral-500);">
                  Enter each option on a new line
                </p>
              </div>

              <!-- Placeholder -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Placeholder Text
                </label>
                <input v-model="newCustomField.placeholder" type="text" class="modern-input"
                  placeholder="e.g., Enter your member ID">
              </div>

              <!-- Default Value -->
              <div>
                <label class="block text-sm font-bold mb-2" style="color: var(--neutral-700);">
                  Default Value
                </label>
                <input v-model="newCustomField.default" type="text" class="modern-input"
                  placeholder="Optional default value">
              </div>

              <!-- Required Checkbox -->
              <div>
                <label class="flex items-center gap-2">
                  <input type="checkbox" v-model="newCustomField.required" class="w-4 h-4">
                  <span class="text-sm font-semibold" style="color: var(--neutral-700);">
                    This field is required
                  </span>
                </label>
              </div>

              <!-- Form Actions -->
              <div class="flex justify-end gap-3 pt-4 border-t" style="border-color: var(--neutral-200);">
                <button type="button" @click="closeCustomFieldModal" class="btn btn-secondary">
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                  <i data-lucide="plus" class="w-4 h-4"></i>
                  Add Field
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- JavaScript will be added in Part 2 -->
    <script type="module">
      // ===================================================================
      // ORGANIZATION DASHBOARD - COMPLETE JAVASCRIPT IMPLEMENTATION
      // ===================================================================


      import { getCookie, deleteCookie } from "./assets/js/utils/cookies.js";
      import { showErrorAlert, showSuccessAlert } from "./assets/js/utils/alerts.js";
      import {
        getOrgOverviewApi,
        getOrgRecentActivityApi,
        getOrgTopPaymentServicesApi,
        getOrgBankCountriesApi,
        getOrgBankAvailableApi,
        verifyOrgBankAccountApi,
        addOrgBankDetailsApi,
        getOrgBankDetailsApi,
        deleteOrgBankDetailApi,
        editOrgBankDetailsApi,
        createOrgPaymentServiceApi,
        getOrgPaymentServicesApi,
        viewOrgPaymentServiceApi,
        editOrgPaymentServiceApi,
        deleteOrgPaymentServiceApi,
        getOrgServicePaymentsApi,
        getOrgSubscribersApi,
      } from "./assets/js/services/organisation/controller.js";
      import { logoutApi } from "./assets/js/services/organisation/auth.js";

      const { createApp } = Vue;

      createApp({
        data() {
          return {
            // ========== AUTHENTICATION & USER DATA ==========
            token: null,
            currentUser: null,
            organizationName: 'Organization',
            userName: 'User',
            userInitials: 'U',

            // ========== UI STATE ==========
            activeView: 'dashboard',
            sidebarOpen: false,
            isGlobalLoading: true,
            isEditMode: false,

            isEditBankMode: false,

            showEditBankModal: false,

            // ========== DASHBOARD DATA ==========
            stats: {
              subscribers: 0,
              payments: 0,
              paymentServices: 0,
              totalRevenue: 0,
            },
            recentActivity: [],
            topServices: [],
            selectedYear: 'all',
            availableYears: [],
            noDataMessage: '',

            // ========== PAYMENT SERVICES ==========
            paymentServices: [],
            serviceSearch: '',
            serviceFilter: 'all',
            selectedService: null,
            showServiceModal: false,
            showCreateServiceModal: false,
            newService: {
              name: '',
              description: '',
              type: 'other-payment',
              serviceCost: 0,
              paymentSubaccount: '',
              startDate: '',
              expiryDate: '',
              collectCustomData: false,
              customFields: [],
              tags: [],
            },
            editingServiceId: null,

            // ========== SUBSCRIBERS ==========
            subscribers: [],
            subscriberSearch: '',

            // ========== BANK DETAILS ==========
            bankAccounts: [],
            bankCountries: [],
            banks: [],
            selectedCountry: 'Nigeria',
            selectedBank: null,
            showAddBankModal: false,
            showEditBankModal: false,
            isVerifyingAccount: false,
            newBankAccount: {
              bankName: '',
              bankCode: '',
              accountNumber: '',
              accountName: '',
            },
            editingBankAccount: null,
            editingBankAccountId: null,

            // ========== CUSTOM FIELDS ==========
            showCustomFieldModal: false,
            newCustomField: {
              name: '',
              type: 'text',
              required: false,
              default: '',
              placeholder: '',
              options: [],
            },


          };
        },

        computed: {
          // ========== SERVICE FILTERS ==========
          activeServicesCount() {
            return this.paymentServices.filter(s => s.status === 'active').length;
          },

          suspendedServicesCount() {
            return this.paymentServices.filter(s => s.status === 'suspended').length;
          },

          filteredServices() {
            let services = this.paymentServices;

            // Filter by status
            if (this.serviceFilter === 'active') {
              services = services.filter(s => s.status === 'active');
            } else if (this.serviceFilter === 'suspended') {
              services = services.filter(s => s.status === 'suspended');
            }

            // Filter by search
            if (this.serviceSearch.trim()) {
              const search = this.serviceSearch.toLowerCase();
              services = services.filter(s =>
                s.name.toLowerCase().includes(search) ||
                (s.description && s.description.toLowerCase().includes(search))
              );
            }

            return services;
          },

          // ========== SUBSCRIBER FILTERS ==========
          filteredSubscribers() {
            let subs = this.subscribers;

            if (this.subscriberSearch.trim()) {
              const search = this.subscriberSearch.toLowerCase();
              subs = subs.filter(s =>
                s.subscriber.fullName.toLowerCase().includes(search) ||
                s.subscriber.email.toLowerCase().includes(search)
              );
            }

            return subs;
          },
        },

        async mounted() {
          // Initialize Lucide icons
          lucide.createIcons();

          // Check authentication
          await this.initializeAuth();

          // Populate available years (from 2020 to current year)
          const currentYear = new Date().getFullYear();
          this.availableYears = Array.from({ length: currentYear - 2020 + 1 }, (_, i) => currentYear - i);

          // Load all data
          if (this.token) {
            await this.loadAllData();
          }

          this.isGlobalLoading = false;
        },

        updated() {
          // Re-initialize icons after DOM updates
          this.$nextTick(() => {
            lucide.createIcons();
          });
        },

        methods: {
          // ===================================================================
          // AUTHENTICATION & INITIALIZATION
          // ===================================================================

          async initializeAuth() {
            try {
              // Get token from cookie
              this.token = getCookie('auth_token');

              if (!this.token) {
                showErrorAlert('Session expired. Please login again.');
                setTimeout(() => {
                  window.location.href = 'login.html';
                }, 2000);
                return;
              }

              // Get user data from cookie
              const userData = getCookie('user_data');
              console.log('User Data:', userData);
              if (userData) {
                try {
                  this.currentUser = userData;
                  this.organizationName = this.currentUser.name || this.currentUser.organizationName || 'Organization';
                  this.userName = this.currentUser.fullName || this.currentUser.name || 'User';
                  this.userInitials = this.userName.charAt(0).toUpperCase();
                } catch (e) {
                  console.error('Error parsing user data:', e);
                }
              }
            } catch (error) {
              console.error('Authentication error:', error);
              showErrorAlert('Authentication failed. Please login again.');
              setTimeout(() => {
                window.location.href = 'login.html';
              }, 2000);
            }
          },

          async loadAllData() {
            try {
              // Load data based on active view
              if (this.activeView === 'dashboard') {
                await Promise.all([
                  this.loadDashboardStats(),
                  this.loadRecentActivity(),
                  this.loadTopServices(),
                ]);
              } else if (this.activeView === 'payment-services') {
                await this.loadPaymentServices();
                await this.loadBankDetails();
              } else if (this.activeView === 'subscribers') {
                await this.loadSubscribers();
              } else if (this.activeView === 'bank-details') {
                await this.loadBankDetails();
              }
            } catch (error) {
              console.error('Error loading data:', error);
              showErrorAlert('Failed to load data. Please refresh the page.');
            }
          },

          // ===================================================================
          // DASHBOARD DATA LOADING
          // ===================================================================

          async loadDashboardStats() {
            try {
              const response = await getOrgOverviewApi(this.selectedYear, this.token);

              if (response.success) {
                this.stats = {
                  subscribers: response.data.subscribers || 0,
                  payments: response.data.payments || 0,
                  paymentServices: response.data.paymentServices || 0,
                  totalRevenue: response.data.totalRevenue || 0,
                };
                // Check if no data for specific year
                this.noDataMessage = '';
                if (this.stats.subscribers === 0 && this.stats.payments === 0 && this.stats.paymentServices === 0 && this.stats.totalRevenue === 0) {
                  this.noDataMessage = 'No data available for the selected year.';
                }
              } else {
                console.error('Failed to load stats:', response.message);
                this.noDataMessage = 'Failed to load data for the selected year.';
              }
            } catch (error) {
              console.error('Error loading dashboard stats:', error);
              this.noDataMessage = 'Error loading dashboard statistics.';
            }
          },

          async loadRecentActivity() {
            try {
              const response = await getOrgRecentActivityApi(10, this.token);

              if (response.success) {
                this.recentActivity = response.data || [];
              } else {
                console.error('Failed to load activity:', response.message);
              }
            } catch (error) {
              console.error('Error loading recent activity:', error);
            }
          },

          async loadTopServices() {
            try {
              const response = await getOrgTopPaymentServicesApi(this.token);

              if (response.success) {
                this.topServices = response.data || [];
              } else {
                console.error('Failed to load top services:', response.message);
              }
            } catch (error) {
              console.error('Error loading top services:', error);
            }
          },

          // ===================================================================
          // PAYMENT SERVICES
          // ===================================================================

          async loadPaymentServices() {
            try {
              const response = await getOrgPaymentServicesApi(this.token);

              if (response.success) {
                this.paymentServices = response.data || [];
              } else {
                showErrorAlert('Failed to load payment services');
              }
            } catch (error) {
              console.error('Error loading payment services:', error);
              showErrorAlert('Failed to load payment services');
            }
          },

          async viewService(service) {
            try {
              const response = await viewOrgPaymentServiceApi(service._id, this.token);

              if (response.success) {
                this.selectedService = response.data;
                this.showServiceModal = true;
              } else {
                showErrorAlert('Failed to load service details');
              }
            } catch (error) {
              console.error('Error viewing service:', error);
              showErrorAlert('Failed to load service details');
            }
          },

          openCreateServiceModal() {
            this.resetNewService();
            this.showCreateServiceModal = true;
          },

          resetNewService() {
            this.newService = {
              name: '',
              description: '',
              type: 'other-payment',
              serviceCost: 0,
              paymentSubaccount: '',
              startDate: '',
              expiryDate: '',
              collectCustomData: false,
              customFields: [],
              tags: [],
            };
          },


          async deleteService(service) {
            if (!confirm(`Are you sure you want to delete "${service.name}"?`)) {
              return;
            }

            try {
              const response = await deleteOrgPaymentServiceApi(service._id, this.token);

              if (response.success) {
                showSuccessAlert('Service deleted successfully');
                await this.loadPaymentServices();
              } else {
                showErrorAlert(response.message || 'Failed to delete service');
              }
            } catch (error) {
              console.error('Error deleting service:', error);
              showErrorAlert('Failed to delete service');
            }
          },
          // ========== PAYMENT SERVICES CRUD ==========

          /**
           * Edit Payment Service
           
           */
          async editService(service) {
            try {
              // Load full service details first
              const response = await viewOrgPaymentServiceApi(service._id, this.token);

              if (!response.success) {
                showErrorAlert('Failed to load service details');
                return;
              }

              // Populate the edit form with existing data
              this.newService = {
                name: response.data.name,
                description: response.data.description,
                type: response.data.type,
                serviceCost: response.data.serviceCost,
                paymentSubaccount: response.data.paymentSubaccount,
                startDate: response.data.startDate === 'N/A' ? '' : response.data.startDate,
                expiryDate: response.data.expiryDate === 'N/A' ? '' : response.data.expiryDate,
                collectCustomData: response.data.collectCustomData,
                customFields: response.data.customFields || [],
                tags: response.data.tags || [],
              };

              // Store the service ID for update
              this.editingServiceId = service._id;
              // Open modal in edit mode
              this.isEditMode = true;
              this.showCreateServiceModal = true;

            } catch (error) {
              console.error('Error loading service for edit:', error);
              showErrorAlert('Failed to load service details');
            }
          },

          /**
           * Update Payment Service
           * Location: Add this new method to Part 2
           */
          async updateService() {
            try {
              // Validate required fields
              if (!this.newService.name || !this.newService.serviceCost) {
                showErrorAlert('Please fill in all required fields');
                return;
              }

              // Prepare payload (only include fields that can be updated)
              const payload = {
                name: this.newService.name,
                description: this.newService.description,
                serviceCost: this.newService.serviceCost,
                startDate: this.newService.startDate || 'N/A',
                expiryDate: this.newService.expiryDate || 'N/A',
                collectCustomData: this.newService.collectCustomData,
                customFields: this.newService.customFields,
                tags: this.newService.tags,
              };

              const response = await editOrgPaymentServiceApi(
                this.editingServiceId,
                payload,
                this.token
              );

              if (response.success) {
                showSuccessAlert('Payment service updated successfully!');
                this.closeCreateServiceModal();
                await this.loadPaymentServices();
              } else {
                showErrorAlert(response.message || 'Failed to update service');
              }
            } catch (error) {
              console.error('Error updating service:', error);
              showErrorAlert('Failed to update service');
            }
          },

          /**
           * Suspend/Activate Service
           * Location: Add this new method to Part 2
           */
          async toggleServiceStatus(service) {
            try {
              const newStatus = service.status === 'active' ? 'suspended' : 'active';
              const action = newStatus === 'suspended' ? 'suspend' : 'activate';

              if (!confirm(`Are you sure you want to ${action} "${service.name}"?`)) {
                return;
              }

              const payload = {
                status: newStatus,
              };

              const response = await editOrgPaymentServiceApi(
                service._id,
                payload,
                this.token
              );

              if (response.success) {
                showSuccessAlert(`Service ${action}d successfully!`);
                await this.loadPaymentServices();
              } else {
                showErrorAlert(response.message || `Failed to ${action} service`);
              }
            } catch (error) {
              console.error('Error toggling service status:', error);
              showErrorAlert('Failed to update service status');
            }
          },

          /**
           * Delete Payment Service - Already implemented but here's the complete version
           * Location: Replace deleteService() in Part 2
           */
          async deleteService(service) {
            if (!confirm(`Are you sure you want to delete "${service.name}"?\n\nThis action cannot be undone.`)) {
              return;
            }

            try {
              const response = await deleteOrgPaymentServiceApi(service._id, this.token);

              if (response.success) {
                showSuccessAlert('Service deleted successfully');
                await this.loadPaymentServices();

                // Also refresh dashboard stats if on dashboard
                if (this.activeView === 'dashboard') {
                  await this.loadDashboardStats();
                }
              } else {
                showErrorAlert(response.message || 'Failed to delete service');
              }
            } catch (error) {
              console.error('Error deleting service:', error);
              showErrorAlert('Failed to delete service');
            }
          },

          /**
           * Modified createService to handle both create and update
           * Location: Replace createService() in Part 2
           */
          async createService() {
            try {
              // If in edit mode, call update instead
              if (this.isEditMode && this.editingServiceId) {
                await this.updateService();
                return;
              }

              // Validate required fields
              if (!this.newService.name || !this.newService.serviceCost) {
                showErrorAlert('Please fill in all required fields');
                return;
              }

              // Prepare payload for creation
              const payload = {
                name: this.newService.name,
                type: this.newService.type,
                description: this.newService.description,
                createdFor: { type: 'subscribers' },
                serviceCost: this.newService.serviceCost,
                paymentSubaccount: this.newService.paymentSubaccount,
                startDate: this.newService.startDate || 'N/A',
                expiryDate: this.newService.expiryDate || 'N/A',
                collectCustomData: this.newService.collectCustomData,
                customFields: this.newService.customFields,
                tags: this.newService.tags,
              };

              const response = await createOrgPaymentServiceApi(payload, this.token);

              if (response.success) {
                showSuccessAlert('Payment service created successfully!');
                this.closeCreateServiceModal();
                await this.loadPaymentServices();

                // Refresh dashboard stats if on dashboard
                if (this.activeView === 'dashboard') {
                  await this.loadDashboardStats();
                }
              } else {
                showErrorAlert(response.message || 'Failed to create service');
              }
            } catch (error) {
              console.error('Error creating service:', error);
              showErrorAlert('Failed to create service');
            }
          },

          // ===================================================================
          // SUBSCRIBERS
          // ===================================================================

          async loadSubscribers() {
            try {
              const response = await getOrgSubscribersApi(this.token);

              if (response.success) {
                this.subscribers = response.data || [];
              } else {
                showErrorAlert('Failed to load subscribers');
              }
            } catch (error) {
              console.error('Error loading subscribers:', error);
              showErrorAlert('Failed to load subscribers');
            }
          },

          // ===================================================================
          // BANK DETAILS
          // ===================================================================

          async loadBankDetails() {
            try {
              const response = await getOrgBankDetailsApi(this.token);

              if (response.success) {
                this.bankAccounts = response.data || [];
              } else {
                showErrorAlert('Failed to load bank details');
              }
            } catch (error) {
              console.error('Error loading bank details:', error);
              showErrorAlert('Failed to load bank details');
            }
          },

          async loadBankCountries() {
            try {
              const response = await getOrgBankCountriesApi(this.token);

              if (response.success) {
                this.bankCountries = (Array.isArray(response.data) ? response.data : []).filter(country => country != null);
              }
            } catch (error) {
              console.error('Error loading bank countries:', error);
            }
          },

          async fetchBanks(country) {
            try {
              const response = await getOrgBankAvailableApi(country, this.token);

              if (response.success) {
                this.banks = (Array.isArray(response.data) ? response.data : []).filter(bank => bank != null);
              } else {
                this.banks = [];
              }
            } catch (error) {
              console.error('Error loading banks:', error);
              this.banks = [];
            }
          },

          openAddBankModal() {
            this.resetBankAccount();
            this.showAddBankModal = true;
            this.loadBankCountries();
            this.fetchBanks('nigeria');
          },

          closeAddBankModal() {
            this.showAddBankModal = false;
            this.resetBankAccount();
          },

          resetBankAccount() {
            this.newBankAccount = {
              bankName: '',
              bankCode: '',
              accountNumber: '',
              accountName: '',
            };
            this.selectedBank = null;
            this.selectedCountry = 'Nigeria';
            this.banks = [];
          },

          onBankChange() {
            if (this.selectedBank) {
              this.newBankAccount.bankName = this.selectedBank.name;
              this.newBankAccount.bankCode = this.selectedBank.code;
            } else {
              this.newBankAccount.bankName = '';
              this.newBankAccount.bankCode = '';
            }
          },

          async verifyBankAccount() {
            if (!this.newBankAccount.accountNumber || !this.newBankAccount.bankCode) {
              showErrorAlert('Please enter account number and select bank');
              return;
            }

            try {
              this.isVerifyingAccount = true;

              const response = await verifyOrgBankAccountApi(
                this.newBankAccount.accountNumber,
                this.newBankAccount.bankCode,
                this.token
              );

              if (response.success) {
                this.newBankAccount.accountName = response.data.account_name;
                showSuccessAlert('Account verified successfully!');
              } else {
                showErrorAlert(response.message || 'Failed to verify account');
              }
            } catch (error) {
              console.error('Error verifying account:', error);
              showErrorAlert('Failed to verify account');
            } finally {
              this.isVerifyingAccount = false;
            }
          },

          async addBankAccount() {
            try {
              // Validate fields
              if (!this.newBankAccount.bankName || !this.newBankAccount.accountNumber || !this.newBankAccount.accountName) {
                showErrorAlert('Please fill in all required fields');
                return;
              }

              const payload = {
                accountNumber: this.newBankAccount.accountNumber,
                bankCode: this.newBankAccount.bankCode,
                bankName: this.newBankAccount.bankName,
                accountName: this.newBankAccount.accountName,
              };

              const response = await addOrgBankDetailsApi(payload, this.token);

              if (response.success) {
                showSuccessAlert('Bank account added successfully!');
                this.closeAddBankModal();
                await this.loadBankDetails();
              } else {
                showErrorAlert(response.message || 'Failed to add bank account');
              }
            } catch (error) {
              console.error('Error adding bank account:', error);
              showErrorAlert('Failed to add bank account');
            }
          },

          async deleteBankAccount(account) {
            if (!confirm(`Are you sure you want to delete this bank account?`)) {
              return;
            }

            try {
              const response = await deleteOrgBankDetailApi(account._id, this.token);

              if (response.success) {
                showSuccessAlert('Bank account deleted successfully');
                await this.loadBankDetails();
              } else {
                showErrorAlert(response.message || 'Failed to delete bank account');
              }
            } catch (error) {
              console.error('Error deleting bank account:', error);
              showErrorAlert('Failed to delete bank account');
            }
          },
          // ========== BANK DETAILS CRUD ==========

          /**
           * Edit Bank Account
           * Location: Replace editBankAccount() in Part 2
           */
          async editBankAccount(account) {
            try {
              // Load bank countries if not loaded
              if (this.bankCountries.length === 0) {
                await this.loadBankCountries();
              }

              // Fetch banks for Nigeria (assuming all are Nigeria for now)
              await this.fetchBanks('nigeria');

              // Populate form with existing data
              this.newBankAccount = {
                bankName: account.bankName,
                bankCode: account.bankCode,
                accountNumber: account.accountNumber,
                accountName: account.accountName,
              };

              // Set selected bank
              this.selectedBank = this.banks.find(b => b.code === account.bankCode) || null;

              // Store account ID for update
              this.editingBankAccountId = account._id;

              // Open modal in edit mode
              this.isEditBankMode = true;
              this.showEditBankModal = true;

            } catch (error) {
              console.error('Error loading bank account for edit:', error);
              showErrorAlert('Failed to load bank account details');
            }
          },

          /**
           * Update Bank Account
           * Location: Add this new method to Part 2
           */
          async updateBankAccount() {
            try {
              // Validate fields
              if (!this.newBankAccount.bankName || !this.newBankAccount.accountNumber || !this.newBankAccount.accountName) {
                showErrorAlert('Please fill in all required fields');
                return;
              }

              const payload = {
                accountNumber: this.newBankAccount.accountNumber,
                bankCode: this.newBankAccount.bankCode,
                bankName: this.newBankAccount.bankName,
                accountName: this.newBankAccount.accountName,
              };

              const response = await editOrgBankDetailsApi(
                this.editingBankAccountId,
                payload,
                this.token
              );

              if (response.success) {
                showSuccessAlert('Bank account updated successfully!');
                this.closeEditBankModal();
                await this.loadBankDetails();
              } else {
                showErrorAlert(response.message || 'Failed to update bank account');
              }
            } catch (error) {
              console.error('Error updating bank account:', error);
              showErrorAlert('Failed to update bank account');
            }
          },

          /**
           * Delete Bank Account - Already implemented but here's the complete version
           * Location: Replace deleteBankAccount() in Part 2
           */
          async deleteBankAccount(account) {
            if (!confirm(`Are you sure you want to delete this bank account?\n\nBank: ${account.bankName}\nAccount: ${account.accountNumber}\n\nThis action cannot be undone.`)) {
              return;
            }

            try {
              const response = await deleteOrgBankDetailApi(account._id, this.token);

              if (response.success) {
                showSuccessAlert('Bank account deleted successfully');
                await this.loadBankDetails();
              } else {
                showErrorAlert(response.message || 'Failed to delete bank account');
              }
            } catch (error) {
              console.error('Error deleting bank account:', error);
              showErrorAlert('Failed to delete bank account');
            }
          },

          /**
           * Modified addBankAccount to handle both add and update
           * Location: Replace addBankAccount() in Part 2
           */
          async addBankAccount() {
            try {
              // If in edit mode, call update instead
              if (this.isEditBankMode && this.editingBankAccountId) {
                await this.updateBankAccount();
                return;
              }

              // Validate fields
              if (!this.newBankAccount.bankName || !this.newBankAccount.accountNumber || !this.newBankAccount.accountName) {
                showErrorAlert('Please fill in all required fields');
                return;
              }

              const payload = {
                accountNumber: this.newBankAccount.accountNumber,
                bankCode: this.newBankAccount.bankCode,
                bankName: this.newBankAccount.bankName,
                accountName: this.newBankAccount.accountName,
              };

              const response = await addOrgBankDetailsApi(payload, this.token);

              if (response.success) {
                showSuccessAlert('Bank account added successfully!');
                this.closeAddBankModal();
                await this.loadBankDetails();
              } else {
                showErrorAlert(response.message || 'Failed to add bank account');
              }
            } catch (error) {
              console.error('Error adding bank account:', error);
              showErrorAlert('Failed to add bank account');
            }
          },
          // ===================================================================
          // CUSTOM FIELDS
          // ===================================================================

          openCustomFieldModal() {
            this.resetCustomField();
            this.showCustomFieldModal = true;
          },

          closeCustomFieldModal() {
            this.showCustomFieldModal = false;
            this.resetCustomField();
          },

          resetCustomField() {
            this.newCustomField = {
              name: '',
              type: 'text',
              required: false,
              default: '',
              placeholder: '',
              options: [],
            };
          },

          addCustomField() {
            if (!this.newCustomField.name) {
              showErrorAlert('Please enter a field name');
              return;
            }

            this.newService.customFields.push({ ...this.newCustomField });
            this.closeCustomFieldModal();
            showSuccessAlert('Custom field added');
          },

          removeCustomField(index) {
            this.newService.customFields.splice(index, 1);
          },

          // ===================================================================
          // UI HELPERS
          // ===================================================================

          setActiveView(view) {
            this.activeView = view;
            this.sidebarOpen = false;

            // Load data for the new view
            this.loadAllData();
          },

          toggleSidebar() {
            this.sidebarOpen = !this.sidebarOpen;
          },

          async handleLogout() {
            if (confirm("Are you sure you want to logout?")) {
              try {
                await logoutApi(this.token);
              } catch (error) {
                alert("Logout failed. Please try again or contact support.");
              }
              // Always clear storage and redirect, regardless of API success
              deleteCookie('auth_token');
              deleteCookie('user_data');
              window.location.href = 'login.html';
            }
          },

          formatCurrency(amount) {
            return (amount || 0).toLocaleString('en-NG', {
              minimumFractionDigits: 0,
              maximumFractionDigits: 2,
            });
          },

          formatDate(dateString) {
            if (!dateString || dateString === 'N/A') return 'N/A';

            try {
              const date = new Date(dateString);
              return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
              });
            } catch (e) {
              return dateString;
            }
          },

          getStatusBadgeClass(status) {
            const statusMap = {
              active: 'status-paid',
              suspended: 'status-pending',
              completed: 'bg-neutral-100',
            };

            return statusMap[status] || 'bg-neutral-100';
          },
          addCustomField() {
            if (!this.newCustomField.name) {
              showErrorAlert('Please enter a field name');
              return;
            }

            // Convert options text to array for select-option type
            if (this.newCustomField.type === 'select-option' && this.newCustomField.optionsText) {
              this.newCustomField.options = this.newCustomField.optionsText
                .split('\n')
                .map(opt => opt.trim())
                .filter(opt => opt.length > 0);
            }

            // Add field to service
            this.newService.customFields.push({
              name: this.newCustomField.name,
              type: this.newCustomField.type,
              required: this.newCustomField.required,
              default: this.newCustomField.default,
              placeholder: this.newCustomField.placeholder,
              options: this.newCustomField.options || [],
            });

            this.closeCustomFieldModal();
            showSuccessAlert('Custom field added successfully');
          },


          // ========== MODAL HELPER METHODS ==========

          /**
           * Close Edit Bank Modal
           * Location: Add this new method to Part 2
           */
          closeEditBankModal() {
            this.showEditBankModal = false;
            this.isEditBankMode = false;
            this.editingBankAccountId = null;
            this.resetBankAccount();
          },

          /**
           * Modified closeCreateServiceModal
           * Location: Replace closeCreateServiceModal() in Part 2
           */
          closeCreateServiceModal() {
            this.showCreateServiceModal = false;
            this.isEditMode = false;
            this.editingServiceId = null;
            this.resetNewService();
          },

        },

        watch: {
          // Watch for view changes
          activeView(newView) {
            console.log('View changed to:', newView);
          },
        },
      }).mount('#app');
    </script>
  </body>

</html>